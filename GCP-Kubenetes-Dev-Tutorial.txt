go install sigs.k8s.io/kind@v0.26.0

gcloud components install skaffold

æç¤ºè¯:
æˆ‘éœ€è¦ç”¨ä¸€ä¸ªhello wordçš„demosprigå¾®æœåŠ¡ï¼Œ å¸®å¸®æˆ‘æ„å»ºï¼Œ è¦æ±‚å¦‚ä¸‹ï¼š
1.ä½¿ç”¨spring cloud
2.ä½¿ç”¨Skaffoldæ¥è‡ªåŠ¨åŒ–æ„å»ºï¼Œæ¨é€å’Œéƒ¨ç½²åº”ç”¨ç¨‹åºï¼›
3.ä½¿ç”¨jibæ„å»ºé•œåƒ
4.ä½¿ç”¨helméƒ¨ç½²åˆ°kubernetesé›†ç¾¤
5.ä½¿ç”¨kindå¸®æˆ‘åˆ›å»º3ä¸ªå‡ ç‚¹çš„é›†ç¾¤ï¼Œæˆ‘æœ¬åœ°éœ€è¦kubernetesé›†ç¾¤ç”¨æ¥å¼€å‘æµ‹è¯•
6.æˆ‘æœ¬åœ°å®‰è£…äº†docker ï¼Œkindæˆ–è®¸å¯ä»¥ç”¨å¾—ä¸Šä»–æ¥æ„å»ºæœ¬åœ°kubernetesé›†ç¾¤
7.è¯·åœ¨æˆ‘çš„d:\workspace_spring_cloudç›®å½•ä¸‹å¼€å§‹åˆ›å»ºå·¥ç¨‹ï¼Œå·¥ç¨‹åä¸ºgcp-helloworld


é¡¹ç›®ç»“æ„å·²ç»åˆ›å»ºå®Œæˆï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Spring Cloud Hello World å¾®æœåŠ¡ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
1. ä½¿ç”¨ Spring Cloud æ¡†æ¶
2. é…ç½®äº† Jib ç”¨äºæ„å»º Docker é•œåƒ
3. é…ç½®äº† Skaffold ç”¨äºè‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²
4. åˆ›å»ºäº† Helm chart ç”¨äº Kubernetes éƒ¨ç½²
5. å‡†å¤‡äº† kind é…ç½®æ–‡ä»¶ç”¨äºåˆ›å»ºæœ¬åœ° Kubernetes é›†ç¾¤

æ¥ä¸‹æ¥çš„æ­¥éª¤æ˜¯ï¼š
1. å®‰è£… kindï¼ˆæŒ‰ç…§ä¸Šè¿°è¯´æ˜ï¼‰
2. åˆ›å»ºæœ¬åœ° Kubernetes é›†ç¾¤
3. ä½¿ç”¨ Skaffold è¿›è¡Œå¼€å‘å’Œéƒ¨ç½²

skaffold dev -v debug

æˆ‘å·²ç»å¯åŠ¨äº† Skaffold çš„å¼€å‘æ¨¡å¼ã€‚è¿™ä¸ªå‘½ä»¤ä¼šï¼š
1. ä½¿ç”¨ Jib æ„å»º Spring Boot åº”ç”¨çš„ Docker é•œåƒ
2. å°†é•œåƒæ¨é€åˆ°æœ¬åœ° registry
3. ä½¿ç”¨ Helm éƒ¨ç½²åº”ç”¨åˆ° Kind é›†ç¾¤
4. ç›‘è§†ä»£ç å˜åŒ–ï¼Œå½“å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°æ„å»ºå’Œéƒ¨ç½²

è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç¬¬ä¸€æ¬¡æ„å»ºå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå› ä¸ºéœ€è¦ä¸‹è½½ Maven ä¾èµ–å’ŒåŸºç¡€ Docker é•œåƒ
2. Skaffold ä¼šæŒç»­è¿è¡Œå¹¶ç›‘è§†æ–‡ä»¶å˜åŒ–
3. å¦‚æœé‡åˆ°ä»»ä½•é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·æ’æŸ¥

æ‚¨å¯ä»¥æŸ¥çœ‹å‘½ä»¤çš„è¾“å‡ºæ¥äº†è§£æ„å»ºå’Œéƒ¨ç½²çš„è¿›åº¦ã€‚å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šå¸®æ‚¨è§£å†³ã€‚

è¦éªŒè¯åº”ç”¨æ˜¯å¦æˆåŠŸéƒ¨ç½²ï¼Œæˆ‘ä»¬å¯ä»¥ç­‰å¾… Skaffold å®Œæˆåˆå§‹éƒ¨ç½²åè¿è¡Œï¼š
kubectl get pods

è¿è¡Œ Skaffoldï¼š
skaffold dev --default-repo=localhost:5000

ç”¨ Skaffold æ¥æ„å»ºå’Œéƒ¨ç½²åº”ç”¨ï¼š
skaffold run --default-repo=localhost:5000


æ£€æŸ¥ä¸€ä¸‹ Docker æœåŠ¡çŠ¶æ€ï¼š
docker ps

æ„å»º
mvn compile jib:build -Djib.allowInsecureRegistries=true

éªŒè¯è¿™ä¸ªé•œåƒæ˜¯å¦å¯ç”¨ï¼š
docker pull mcr.microsoft.com/openjdk/jdk:17-ubuntu

ç”¨ Jib æ¥æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ï¼š
mvn compile jib:build

1. åˆ é™¤ç°æœ‰çš„é›†ç¾¤ï¼š
kind delete cluster --name gcp-helloworld-cluster

2.åˆ›å»ºä¸€ä¸ª Docker ç½‘ç»œç”¨äºæœ¬åœ° registryï¼š
docker network create kind

3.è¿è¡Œæœ¬åœ° registry å®¹å™¨ï¼š
docker run -d --restart=always -p 5000:5000 --name registry --network kind registry:2

4.åˆ›å»ºæ–°çš„ Kind é›†ç¾¤ï¼š
kind create cluster --name gcp-helloworld-cluster --config kind-config.yaml
âœ“ Ensuring node image (kindest/node:v1.32.0) ğŸ–¼
 â€¢ Preparing nodes ğŸ“¦ ğŸ“¦ ğŸ“¦   ...
 âœ“ Preparing nodes ğŸ“¦ ğŸ“¦ ğŸ“¦ 
 â€¢ Writing configuration ğŸ“œ  ...
 âœ“ Writing configuration ğŸ“œ
 â€¢ Starting control-plane ğŸ•¹ï¸  ...
 âœ“ Starting control-plane ğŸ•¹ï¸
 â€¢ Installing CNI ğŸ”Œ  ...
 âœ“ Installing CNI ğŸ”Œ
 â€¢ Installing StorageClass ğŸ’¾  ...
 âœ“ Installing StorageClass ğŸ’¾
 â€¢ Joining worker nodes ğŸšœ  ...
 âœ“ Joining worker nodes ğŸšœ
Set kubectl context to "kind-gcp-helloworld-cluster"
You can now use your cluster with:

kubectl cluster-info --context kind-gcp-helloworld-cluster

Have a nice day! ğŸ‘‹

5.è¿æ¥æœ¬åœ° registry åˆ° Kind ç½‘ç»œï¼š
docker network connect kind registry

6.éƒ¨ç½²åº”ç”¨ï¼š
skaffold run

7.æ£€æŸ¥ä¸€ä¸‹ pod çš„çŠ¶æ€ï¼š
kubectl get pods

8.æ£€æŸ¥ä¸€ä¸‹æœåŠ¡çš„çŠ¶æ€ï¼š
kubectl get svc

ç”±äºæˆ‘ä»¬çš„æœåŠ¡ç±»å‹æ˜¯ ClusterIPï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼è®¿é—®åº”ç”¨ï¼š

9.ä½¿ç”¨ç«¯å£è½¬å‘ï¼š
kubectl port-forward svc/gcp-helloworld 8080:8080

10.ç°åœ¨ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®åº”ç”¨ï¼š

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttp://localhost:8080
æˆ–è€…ä½¿ç”¨ curlï¼š
curl http://localhost:8080

ä¸‹æ¬¡è¿è¡Œ

1.Kind é›†ç¾¤æ˜¯å¦æ­£åœ¨è¿è¡Œï¼š
kind get clusters

2ç¡®è®¤æœ¬åœ° registry æ˜¯å¦è¿è¡Œï¼š
docker ps

3.ä½¿ç”¨ Skaffold éƒ¨ç½²å¹¶è¿è¡Œåº”ç”¨ï¼š
skaffold run

åˆ é™¤ç°æœ‰é›†ç¾¤ï¼š
kind delete cluster --name gcp-helloworld-cluster

åˆ é™¤å¹¶é‡æ–°åˆ›å»ºæœ¬åœ° registryï¼š
docker rm -f registry

docker run -d --restart=always -p 5000:5000 --name registry --network kind registry:2

é‡æ–°åˆ›å»ºé›†ç¾¤ï¼š
kind create cluster --name gcp-helloworld-cluster --config kind-config.yaml

è¿æ¥ registry åˆ° kind ç½‘ç»œï¼š
docker network connect kind registry

ç°åœ¨é‡æ–°éƒ¨ç½²åº”ç”¨ï¼š
skaffold run

ç°åœ¨åº”ç”¨å·²ç»éƒ¨ç½²æˆåŠŸï¼Œè®©æˆ‘ä»¬è®¾ç½®ç«¯å£è½¬å‘ä»¥è®¿é—®åº”ç”¨ï¼š
kubectl port-forward svc/gcp-helloworld 8080:8080

ç°åœ¨ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®åº”ç”¨ï¼š

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttp://localhost:8080
æˆ–è€…ä½¿ç”¨ curlï¼š
curl http://localhost:8080

åº”ç”¨å·²ç»æˆåŠŸè¿è¡Œï¼ä½ å¯ä»¥ï¼š
1. é€šè¿‡æµè§ˆå™¨è®¿é—® http://localhost:8080 æŸ¥çœ‹åº”ç”¨
2. ä½¿ç”¨ kubectl logs æŸ¥çœ‹åº”ç”¨æ—¥å¿—
3. ä½¿ç”¨ kubectl get pods æŸ¥çœ‹ pod çŠ¶æ€

å¦‚æœä½ æƒ³åœæ­¢åº”ç”¨ï¼Œå¯ä»¥ï¼š
1. æŒ‰ Ctrl+C åœæ­¢ç«¯å£è½¬å‘
2. è¿è¡Œ skaffold delete åˆ é™¤éƒ¨ç½²

éœ€è¦æˆ‘å¸®ä½ æ‰§è¡Œå…¶ä»–æ“ä½œå—ï¼Ÿ